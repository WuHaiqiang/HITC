"use strict";(self["webpackChunkcxs_currency_sys_client"]=self["webpackChunkcxs_currency_sys_client"]||[]).push([[624],{37431:function(t,e,i){i.r(e),i.d(e,{default:function(){return h}});var a=function(){var t=this,e=t._self._c;return e("div",{staticClass:"site-content clean content",staticStyle:{transform:"none"}},[e("MyBreadcrumb",{attrs:{breadcrumb:!0}}),e("div",{staticClass:"content-area",attrs:{id:"primary"}},[e("el-form",{ref:"ruleForm",staticClass:"demo-ruleForm",staticStyle:{padding:"20px 0"},attrs:{model:t.articleForm,rules:t.rules,"label-width":"100px"}},[e("el-row",[e("el-col",{staticStyle:{padding:"0 10px"},attrs:{span:24}},[e("el-form-item",{staticStyle:{"margin-bottom":"20px"},attrs:{"label-width":"70px",label:"标题",prop:"articleTitle"}},[e("el-input",{staticClass:"article-textarea",staticStyle:{width:"400px"},attrs:{rows:1,type:"textarea",maxlength:"20","show-word-limit":"",autosize:"",placeholder:"请输入文章标题,不超过20字"},model:{value:t.articleForm.articleTitle,callback:function(e){t.$set(t.articleForm,"articleTitle",e)},expression:"articleForm.articleTitle"}})],1)],1)],1),e("el-row",[e("el-col",{staticStyle:{padding:"0 10px"},attrs:{span:24}},[e("el-form-item",{staticStyle:{"margin-bottom":"20px"},attrs:{"label-width":"70px",label:"摘要",prop:"articleAbstract"}},[e("el-input",{staticClass:"article-textarea",staticStyle:{width:"600px"},attrs:{rows:1,maxlength:"130","show-word-limit":"",type:"textarea",autosize:"",placeholder:"请输入文章摘要，0-130字"},model:{value:t.articleForm.articleAbstract,callback:function(e){t.$set(t.articleForm,"articleAbstract",e)},expression:"articleForm.articleAbstract"}})],1)],1)],1),e("el-row",[e("el-col",{staticStyle:{padding:"0 10px"},attrs:{span:24}},[e("div",{staticClass:"postInfo-container"},[e("el-row",[e("el-col",{attrs:{span:12}},[e("el-form-item",{staticClass:"postInfo-container-item",attrs:{"label-width":"70px",label:"分类",prop:"articleType"}},[e("el-select",{staticStyle:{width:"400px"},attrs:{filterable:"","default-first-option":"",placeholder:"选择分类"},model:{value:t.articleForm.articleType,callback:function(e){t.$set(t.articleForm,"articleType",e)},expression:"articleForm.articleType"}},t._l(t.teachnologyList,(function(i){return e("el-option-group",{key:i.id,attrs:{label:i.typeName}},t._l(i.children,(function(t){return e("el-option",{key:t.id,attrs:{label:t.typeName,value:t.id}})})),1)})),1)],1)],1),e("el-col",{attrs:{span:12}},[e("el-form-item",{staticClass:"postInfo-container-item",attrs:{"label-width":"90px",label:"是否原创"}},[e("el-switch",{staticStyle:{display:"block","margin-left":"0","margin-top":"9px"},attrs:{"active-color":"#13ce66","active-value":1,"inactive-value":0,"active-text":"原创","inactive-text":"转载"},model:{value:t.articleForm.articleIsSelf,callback:function(e){t.$set(t.articleForm,"articleIsSelf",e)},expression:"articleForm.articleIsSelf"}})],1)],1)],1)],1)])],1),0===t.articleForm.articleIsSelf?e("el-row",[e("el-col",{staticStyle:{padding:"0 10px"},attrs:{span:24}},[e("el-form-item",{staticStyle:{"margin-bottom":"20px"},attrs:{"label-width":"70px",label:"原文地址"}},[e("el-input",{staticClass:"article-textarea",staticStyle:{width:"600px"},attrs:{rows:1,maxlength:"80","show-word-limit":"",type:"textarea",autosize:"",placeholder:"转载请输入原文地址"},model:{value:t.articleForm.originalLink,callback:function(e){t.$set(t.articleForm,"originalLink",e)},expression:"articleForm.originalLink"}})],1)],1)],1):t._e(),e("el-row",[e("el-col",{staticStyle:{padding:"0 10px"},attrs:{span:24}},[e("el-form-item",{staticClass:"postInfo-container-item",attrs:{"label-width":"50px",label:"标签"}},t._l(t.articleForm.tags,(function(i){return e("el-tag",{key:i.tagId,staticStyle:{"margin-right":"10px"},attrs:{size:"small",closable:""},on:{close:function(e){return t.handleClose(i)}}},[t._v(" "+t._s(i.tagName)+" ")])})),1),e("el-form-item",{staticClass:"postInfo-container-item",attrs:{"label-width":"50px"}},[e("el-row",t._l(t.tags,(function(i){return e("el-tag",{key:i.tagId,staticClass:"cursor tag",staticStyle:{"margin-right":"10px"},attrs:{size:"small",type:"info"},on:{click:function(e){return t.addTag(i)}}},[t._v(" "+t._s(i.tagName)+" ")])})),1)],1)],1)],1),e("el-row",[e("el-col",{staticStyle:{padding:"0 10px"},attrs:{span:24}},[e("el-form-item",{attrs:{"label-width":"1px",prop:"articleDetail"}},[e("v-md-editor",{attrs:{height:"500px","disabled-menus":[]},on:{"upload-image":t.handleUploadImage},model:{value:t.articleForm.articleDetail,callback:function(e){t.$set(t.articleForm,"articleDetail",e)},expression:"articleForm.articleDetail"}})],1)],1)],1),e("el-row",[e("el-col",{staticStyle:{padding:"0 10px"},attrs:{span:24}},[e("el-form-item",{staticClass:"postInfo-container-item",attrs:{"label-width":"60px",label:"依赖包",prop:"file"}},[e("el-upload",{ref:"upload",staticClass:"upload-demo",attrs:{action:"","file-list":t.fileList,limit:1,"on-change":t.fileChange,"on-remove":t.fileRemove,"auto-upload":!1}},[e("el-button",{attrs:{slot:"trigger",size:"small",type:"primary"},slot:"trigger"},[t._v("选取文件")]),e("div",{staticClass:"el-upload__tip",attrs:{slot:"tip"},slot:"tip"},[t._v("只能上传.zip文件，且不超过20mb")])],1)],1)],1)],1),e("el-row",[e("el-col",{staticStyle:{padding:"0 10px"},attrs:{span:24}},[e("el-form-item",{attrs:{label:"封面"}},[e("div",{staticClass:"block",staticStyle:{width:"300px",height:"250px",border:"1px solid #ccc"}},[t.articleForm.articleCover?e("el-image",{attrs:{src:t.baseUrl+t.articleForm.articleCover}},[e("div",{staticClass:"image-slot",attrs:{slot:"error"},slot:"error"},[e("i",{staticClass:"el-icon-picture-outline"})])]):t._e()],1),e("el-button",{staticStyle:{position:"absolute",bottom:"110px","margin-left":"430px"},attrs:{type:"primary",size:"small",icon:"el-icon-upload"},on:{click:function(e){t.imagecropperShow=!0}}},[t._v(" 选择封面 ")]),e("image-cropper",{directives:[{name:"show",rawName:"v-show",value:t.imagecropperShow,expression:"imagecropperShow"}],key:t.imagecropperKey,attrs:{width:300,height:250,field:"file",url:"/server/base/file/upload","lang-type":"zh"},on:{close:t.close,"crop-upload-success":t.cropSuccess}})],1)],1)],1),e("el-row",[e("el-col",{staticStyle:{padding:"0 10px"},attrs:{span:24}},[t.articleForm.updateTime?e("div",{staticStyle:{"text-align":"end","margin-bottom":"10px","margin-right":"10px"}},[t._v(" 上次保存: "+t._s(t.articleForm.updateTime)+" ")]):t._e(),e("el-form-item",{staticStyle:{"text-align":"end"}},[e("el-button",{attrs:{type:"info"},on:{click:function(e){return t.draftHandle()}}},[t._v("保存草稿")]),e("el-button",{attrs:{type:"primary"},on:{click:function(e){return t.publishHandle()}}},[t._v("立即创建")]),e("el-button",{on:{click:function(e){return t.canalHandle()}}},[t._v("取消")])],1)],1)],1)],1),e("el-dialog",{attrs:{title:t.dialogInfo[t.dialogFlag].title,visible:t.dialogVisible,width:"30%"},on:{"update:visible":function(e){t.dialogVisible=e}}},[e("span",[t._v(t._s(t.dialogInfo[t.dialogFlag].tip))]),e("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[e("el-button",{on:{click:function(e){t.dialogVisible=!1}}},[t._v("取 消")]),e("el-button",{attrs:{type:"primary"},on:{click:function(e){return t.confirmHandle()}}},[t._v("确 定")])],1)])],1)],1)},l=[],r=(i(28743),i(80503)),s=i(6495),o=i(52004),c=i(4754),n=i(50404);const p={articleCover:"",articleTitle:"",articleType:void 0,articleAbstract:"",articleIsSelf:0,file:{},tags:[],articleDetail:"",updateTime:""};var d={name:"PublishArticle",components:{ImageCropper:n.A},data(){var t=(t,e,i)=>{let a=this.articleForm.file;if(a&&Object.keys(a).length>0){let t=a.name;if(t){const e=t.substring(t.lastIndexOf("."));".zip"===e?a.size/1024/1024>20?i(new Error("只能上传0-20MB的.zip文件,当前大小:"+Math.round(a.size/1024/1024)+"MB")):i():i(new Error("只能上传.zip类型的文件,当前文件类型"+e))}else i(new Error("文件名不能为空"))}else i()};return{baseUrl:o.f,imagecropperKey:0,imagecropperShow:!1,teachnologyList:[],articleForm:{articleCover:"",articleTitle:"",articleType:void 0,articleAbstract:"",articleIsSelf:0,file:{},tags:[],articleDetail:"",updateTime:""},rules:{articleTitle:[{required:!0,message:"文章标题为必填项",trigger:"blur"},{min:0,max:20,message:"长度在 0 到 20 个字符",trigger:"blur"}],articleAbstract:[{required:!0,message:"文章摘要为必填项",trigger:"blur"},{min:0,max:130,message:"长度在 0 到 130 个字符",trigger:"blur"}],articleType:[{required:!0,message:"文章所属类型为必选项",trigger:"blur"}],articleDetail:[{required:!0,message:"文章详情为必填项",trigger:"blur"}],file:[{validator:t,trigger:"blur"}]},text:"测试",tags:[],fileList:[],dialogVisible:!1,dialogInfo:{publish:{title:"文章发布",tip:"发布后将进入审核状态,确认发布吗?"},draft:{title:"保存草稿",tip:"依赖文件不会保存为草稿"},canal:{title:"取消",tip:"系统不会保存你的输入信息,确认取消吗?"}},dialogFlag:"draft"}},mounted(){this.init()},methods:{init(){(0,r.J_)().then((t=>{this.teachnologyList=t.data})),(0,r.Tn)().then((t=>{this.tags=t.data})),(0,c.ou)().then((t=>{if(t.data&&Object.keys(t.data).length>0){this.articleForm=t.data;const{tags:e}=t.data;if(e&&e.length>0){const t=this.tags.filter((t=>-1!==e.indexOf(t.tagId)));this.articleForm.tags=t}}}))},handleUploadImage(t,e,i){(0,s.UM)(i[0]).then((t=>{e({url:o.f+t.data,desc:"描述",width:"auto",height:"auto"})}))},addTag(t){if(this.articleForm.tags.length>=5)this.$message.warning("标签最多添加5个");else{const e=this.articleForm.tags.find((e=>e.tagId===t.tagId));e?this.$message.warning("该标签已添加"):this.articleForm.tags.push(t)}},handleClose(t){this.articleForm.tags.splice(this.articleForm.tags.indexOf(t),1)},fileChange(t,e){this.articleForm.file=t},fileRemove(t,e){this.articleForm.file=void 0},saveDraft(){(0,c.JR)(this.articleForm).then((t=>{this.$message.info("草稿保存成功"),this.dialogVisible=!1}))},canalHandle(){this.dialogFlag="canal",this.dialogVisible=!0},draftHandle(){this.dialogFlag="draft",this.dialogVisible=!0},publishHandle(){this.$refs.ruleForm.validate((t=>{if(!t)return!1;this.dialogFlag="publish",this.dialogVisible=!0}))},confirmHandle(){const t=this.dialogFlag;"draft"===t?this.saveDraft():"canal"===t?(this.dialogVisible=!1,this.$router.back()):"publish"===t&&this.publishArticle()},publishArticle(){const t=this.$loading({lock:!0,text:"正在发布文章、请稍后",spinner:"el-icon-loading",background:"rgba(0, 0, 0, 0.7)"});(0,c.oc)(this.articleForm).then((e=>{this.$message.success("文章发布成功、进入审核阶段"),t.close(),this.dialogVisible=!1,this.$nextTick((()=>{this.articleForm=p,this.fileList=[],this.$refs.ruleForm.resetFields()}))})),setTimeout((()=>{t.close(),this.dialogVisible=!1}),2e3)},cropSuccess(t){this.imagecropperShow=!1,this.imagecropperKey=this.imagecropperKey+1,this.articleForm.articleCover=t},close(){this.imagecropperShow=!1}}},m=d,g=i(81656),u=(0,g.A)(m,a,l,!1,null,"10a90e79",null),h=u.exports}}]);