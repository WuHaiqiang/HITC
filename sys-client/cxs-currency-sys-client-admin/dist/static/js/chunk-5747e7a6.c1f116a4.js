(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-5747e7a6"],{"33e3":function(e,t,a){},6133:function(e,t,a){"use strict";a.r(t);var n=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"app-container"},[a("el-button",{attrs:{type:"primary"},on:{click:e.handleAddTask}},[e._v("创建新任务")]),a("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.listLoading,expression:"listLoading"}],staticStyle:{width:"100%","margin-top":"30px"},attrs:{data:e.taskList,border:""}},[a("el-table-column",{attrs:{resizable:!1,align:"center",label:"序号",width:"80"},scopedSlots:e._u([{key:"default",fn:function(t){t.scope;var a=t.$index;return[e._v(" "+e._s(a+1)+" ")]}}])}),a("el-table-column",{attrs:{resizable:!1,align:"center",label:"任务标识",width:"200"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(" "+e._s(t.row.taskKey)+" ")]}}])}),a("el-table-column",{attrs:{resizable:!1,align:"center",label:"任务名称",width:"200"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(" "+e._s(t.row.taskName)+" ")]}}])}),a("el-table-column",{attrs:{resizable:!1,"show-overflow-tooltip":!0,align:"center",label:"任务描述",width:"200"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(" "+e._s(t.row.taskDesc)+" ")]}}])}),a("el-table-column",{attrs:{resizable:!1,align:"center",label:"执行周期",width:"200"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(" "+e._s(t.row.taskCron)+" ")]}}])}),a("el-table-column",{attrs:{resizable:!1,align:"center",label:"任务状态",width:"120"},scopedSlots:e._u([{key:"default",fn:function(e){return[a("el-switch",{attrs:{value:1===e.row.taskStatus,"active-color":"#13ce66","inactive-color":"#ccc"}})]}}])}),a("el-table-column",{attrs:{resizable:!1,align:"center",label:"运行状态",width:"120"},scopedSlots:e._u([{key:"default",fn:function(t){return[t.row.runStatus?a("el-tag",{attrs:{type:"success",effect:"dark"}},[e._v(" 运行中 ")]):a("el-tag",{attrs:{type:"info"}},[e._v(" 已停止 ")])]}}])}),a("el-table-column",{attrs:{align:"center",resizable:!1,label:"创建时间",width:"200"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(" "+e._s(t.row.createTime)+" ")]}}])}),a("el-table-column",{attrs:{align:"center",resizable:!1,"min-width":"500",label:"操作",fixed:"right"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-button",{attrs:{type:"primary",size:"small"},on:{click:function(a){return e.handleEdit(t)}}},[e._v("编辑")]),a("el-button",{attrs:{type:"primary",disabled:t.row.runStatus,size:"small"},on:{click:function(a){return e.operaHandle(t,1)}}},[e._v("启动")]),a("el-button",{attrs:{type:"primary",disabled:!t.row.runStatus,size:"small"},on:{click:function(a){return e.operaHandle(t,3)}}},[e._v("重启")]),a("el-button",{attrs:{type:"primary",disabled:!t.row.runStatus,size:"small"},on:{click:function(a){return e.operaHandle(t,2)}}},[e._v("停止")]),a("el-button",{attrs:{type:"primary",disabled:1!==t.row.taskStatus,size:"small"},on:{click:function(a){return e.execute(t)}}},[e._v("执行一次")]),a("el-button",{attrs:{type:"primary",size:"small"},on:{click:function(a){return e.showLog(t)}}},[e._v("日志")]),a("el-button",{attrs:{type:"danger",disabled:t.row.runStatus,size:"small"},on:{click:function(a){return e.handleDelete(t)}}},[e._v("删除")])]}}])})],1),a("el-dialog",{attrs:{visible:e.dialogVisible,title:"edit"===e.dialogType?"编辑任务":"新增任务"},on:{"update:visible":function(t){e.dialogVisible=t}}},[a("el-form",{attrs:{model:e.task,"label-width":"80px","label-position":"left"}},[a("el-form-item",{attrs:{label:"任务标识"}},[a("el-input",{attrs:{placeholder:"任务标识"},model:{value:e.task.taskKey,callback:function(t){e.$set(e.task,"taskKey",t)},expression:"task.taskKey"}})],1),a("el-form-item",{attrs:{label:"任务名称"}},[a("el-input",{attrs:{placeholder:"任务名称"},model:{value:e.task.taskName,callback:function(t){e.$set(e.task,"taskName",t)},expression:"task.taskName"}})],1),a("el-form-item",{attrs:{label:"任务描述"}},[a("el-input",{attrs:{placeholder:"任务描述"},model:{value:e.task.taskDesc,callback:function(t){e.$set(e.task,"taskDesc",t)},expression:"task.taskDesc"}})],1),a("el-form-item",{attrs:{label:"执行周期"}},[a("el-input",{attrs:{placeholder:"执行周期"},model:{value:e.task.taskCron,callback:function(t){e.$set(e.task,"taskCron",t)},expression:"task.taskCron"}})],1),a("el-form-item",{attrs:{label:"任务状态"}},[a("el-select",{attrs:{filterable:"",placeholder:"请选择任务状态"},on:{change:function(t){return e.taskTypeChange(t)}},model:{value:e.task.taskStatus,callback:function(t){e.$set(e.task,"taskStatus",t)},expression:"task.taskStatus"}},[a("el-option",{attrs:{label:"开启",value:1}}),a("el-option",{attrs:{label:"禁用",value:0}})],1)],1)],1),a("div",{staticStyle:{"text-align":"right"}},[a("el-button",{attrs:{type:"danger"},on:{click:function(t){e.dialogVisible=!1}}},[e._v("取消")]),a("el-button",{attrs:{type:"primary"},on:{click:e.confirmTask}},[e._v("确认")])],1)],1),a("el-dialog",{attrs:{visible:e.logDialogVisible,width:"70%",title:e.currentTask.taskName},on:{"update:visible":function(t){e.logDialogVisible=t}}},[a("el-form",{staticClass:"demo-form-inline",attrs:{inline:!0,model:e.queryPage}},[a("el-form-item",{attrs:{label:"执行状态"}},[a("el-select",{attrs:{placeholder:"请选择"},model:{value:e.queryPage.executeStatus,callback:function(t){e.$set(e.queryPage,"executeStatus",t)},expression:"queryPage.executeStatus"}},[a("el-option",{attrs:{label:"请选择",value:null}}),a("el-option",{attrs:{label:"执行成功",value:!0}}),a("el-option",{attrs:{label:"执行失败",value:!1}})],1)],1),a("el-form-item",{attrs:{label:"执行时间"}},[a("el-date-picker",{attrs:{type:"datetimerange","picker-options":e.pickerOptions,"range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期",align:"right"},model:{value:e.queryPage.timeRange,callback:function(t){e.$set(e.queryPage,"timeRange",t)},expression:"queryPage.timeRange"}})],1),a("el-form-item",[a("el-button",{attrs:{type:"primary"},on:{click:e.onSubmit}},[e._v("查询")])],1)],1),a("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.listLoading,expression:"listLoading"}],staticStyle:{width:"100%","margin-top":"30px"},attrs:{data:e.pageInfo.data,border:""}},[a("el-table-column",{attrs:{"show-overflow-tooltip":!0,resizable:!1,align:"center",label:"序号",width:"80"},scopedSlots:e._u([{key:"default",fn:function(t){t.scope;var a=t.$index;return[e._v(" "+e._s(a+1)+" ")]}}])}),a("el-table-column",{attrs:{"show-overflow-tooltip":!0,resizable:!1,align:"center",label:"任务名称",width:"250"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(" "+e._s(e.currentTask.taskName)+" ")]}}])}),a("el-table-column",{attrs:{resizable:!1,align:"center",label:"执行状态",width:"150"},scopedSlots:e._u([{key:"default",fn:function(t){return[t.row.executeStatus?a("el-tag",{attrs:{type:"success",effect:"dark"}},[e._v(" 执行成功 ")]):a("el-tag",{attrs:{type:"danger"}},[e._v(" 执行失败 ")])]}}])}),a("el-table-column",{attrs:{align:"center",resizable:!1,"show-overflow-tooltip":!0,label:"执行说明",width:"300"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(" "+e._s(t.row.executeDesc)+" ")]}}])}),a("el-table-column",{attrs:{align:"center",resizable:!1,label:"执行时间",width:"250"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(" "+e._s(t.row.executeTime)+" ")]}}])})],1),a("el-pagination",{staticStyle:{"text-align":"end"},attrs:{"current-page":e.pageInfo.pageNum,"page-sizes":[5,10,20,50],"page-size":e.pageInfo.pageSize,layout:"total, sizes, prev, pager, next, jumper",total:e.pageInfo.total},on:{"size-change":e.handleSizeChange,"current-change":e.handleCurrentChange}}),a("div",{staticStyle:{"text-align":"right"}},[a("el-button",{attrs:{type:"primary",size:"small"},on:{click:function(t){e.logDialogVisible=!1}}},[e._v("关闭")])],1)],1)],1)},s=[],i=a("c7eb"),l=a("1da1"),r=(a("99af"),a("14d9"),a("ed08")),o=a("b199"),c=a("8a60"),u=a.n(c),d={taskId:void 0,taskKey:"",taskName:"",taskDesc:"",taskStatus:0,taskCron:""},p={pageNum:1,pageSize:5,timeRange:null,executeStatus:null,taskId:null},g={name:"Task",data:function(){return{task:Object.assign({},d),taskList:[],listLoading:!0,dialogVisible:!1,dialogType:"new",currentTask:{},logDialogVisible:!1,pageInfo:{},queryPage:{pageNum:1,pageSize:5,timeRange:null,executeStatus:null,taskId:null},pickerOptions:{shortcuts:[{text:"最近一周",onClick:function(e){var t=new Date,a=new Date;a.setTime(a.getTime()-6048e5),e.$emit("pick",[a,t])}},{text:"最近一个月",onClick:function(e){var t=new Date,a=new Date;a.setTime(a.getTime()-2592e6),e.$emit("pick",[a,t])}},{text:"最近三个月",onClick:function(e){var t=new Date,a=new Date;a.setTime(a.getTime()-7776e6),e.$emit("pick",[a,t])}}]}}},watch:{queryPage:{deep:!0,immediate:!0,handler:function(e,t){this.logDialogVisible&&this.getLogList(e)}}},created:function(){this.getList()},methods:{taskTypeChange:function(e){this.$forceUpdate()},getList:function(){var e=this;this.listLoading=!0,Object(o["b"])().then((function(t){e.listLoading=!1,e.taskList=t.data}))},handleAddTask:function(){this.task=Object.assign({},d),this.dialogType="new",this.dialogVisible=!0},handleEdit:function(e){this.dialogType="edit",this.dialogVisible=!0,this.task=Object(r["c"])(e.row)},handleDelete:function(e){var t=this,a=(e.$index,e.row);this.$confirm("确定要删除这个任务吗?","Warning",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(Object(l["a"])(Object(i["a"])().mark((function e(){return Object(i["a"])().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,Object(o["d"])(a.taskId);case 2:t.$message({type:"success",message:"任务删除成功!"}),t.getList();case 4:case"end":return e.stop()}}),e)})))).catch((function(e){console.error(e)}))},operaHandle:function(e,t){var a=this,n={taskId:e.row.taskId,operaType:t};Object(o["f"])(n).then((function(e){a.$message({type:"success",message:e.msg}),a.getList()}))},showLog:function(e){this.queryPage=u.a.deepClone(p),this.currentTask=e.row,this.queryPage.taskId=e.row.taskId,this.logDialogVisible=!0},execute:function(e){var t=this;Object(o["a"])(e.row.taskId).then((function(e){t.$message({type:"success",message:e.msg})}))},confirmTask:function(){var e=this;return Object(l["a"])(Object(i["a"])().mark((function t(){var a,n,s,l,r,c,u;return Object(i["a"])().wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(a="edit"===e.dialogType,!a){t.next=6;break}return t.next=4,Object(o["e"])(e.task);case 4:t.next=13;break;case 6:return e.task.taskId=void 0,t.next=9,Object(o["e"])(e.task);case 9:n=t.sent,s=n.data,e.task.taskId=s.taskId,e.taskList.push(e.task);case 13:l=e.task,r=l.taskDesc,c=l.taskId,u=l.taskName,e.dialogVisible=!1,e.$notify({title:"Success",dangerouslyUseHTMLString:!0,message:"\n            <div>task Id: ".concat(c,"</div>\n            <div>task Name: ").concat(u,"</div>\n            <div>Description: ").concat(r,"</div>\n          "),type:"success"}),e.getList();case 17:case"end":return t.stop()}}),t)})))()},getLogList:function(e){var t=this;this.listLoading=!0,Object(o["c"])(e).then((function(e){t.listLoading=!1,t.pageInfo=e.data}))},handleSizeChange:function(e){this.queryPage.pageSize=e},handleCurrentChange:function(e){this.queryPage.pageNum=e},onSubmit:function(){this.getList(this.queryPage)}}},k=g,f=(a("ad33"),a("2877")),b=Object(f["a"])(k,n,s,!1,null,"81303754",null);t["default"]=b.exports},ad33:function(e,t,a){"use strict";a("33e3")},b199:function(e,t,a){"use strict";a.d(t,"b",(function(){return i})),a.d(t,"e",(function(){return l})),a.d(t,"f",(function(){return r})),a.d(t,"d",(function(){return o})),a.d(t,"a",(function(){return c})),a.d(t,"c",(function(){return u}));var n=a("b775"),s=a("da71");function i(e){return Object(n["a"])({url:s["a"]+"/admin/task/getTaskList",method:"post",params:{keyword:e}})}function l(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return Object(n["a"])({url:s["a"]+"/admin/task/saveOrUpdateTask",method:"post",data:e})}function r(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return Object(n["a"])({url:s["a"]+"/admin/task/taskOperaHandle",method:"post",data:e})}function o(e){return Object(n["a"])({url:s["a"]+"/admin/task/removeTask/".concat(e),method:"delete"})}function c(e){return Object(n["a"])({url:s["a"]+"/admin/task/executeTask/".concat(e),method:"get"})}function u(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return Object(n["a"])({url:s["a"]+"/admin/task/getTaskLog",method:"post",data:e})}}}]);